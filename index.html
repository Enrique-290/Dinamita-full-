<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DIN√ÅMITA POS ‚Äî Demo cat√°logo</title>
<style>
  :root{ --rojo:#d32b2b; --negro:#121212; --gris:#f4f4f5; --morado:#6c4ef7; }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial; background:#fff; color:#111;}
  header{display:flex;gap:12px;align-items:center;padding:14px 16px;border-bottom:1px solid #eee;position:sticky;top:0;background:#fff;z-index:5}
  .brand{display:flex;gap:10px;align-items:center;font-weight:800;letter-spacing:.5px}
  .dot{width:24px;height:24px;border-radius:7px;background:conic-gradient(var(--rojo), #ff6a00, var(--rojo)); box-shadow:0 0 0 2px #000 inset}
  .mode{margin-left:auto;font-size:.85rem;color:#b91c1c;font-weight:700}
  .search{width:100%;max-width:720px;margin:8px auto 0;padding:10px 12px;border:1px solid #ddd;border-radius:12px;font-size:16px}
  .wrap{max-width:1100px;margin:0 auto;padding:12px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;margin-top:12px}
  .card{border:1px solid #eee;border-radius:14px;padding:10px;background:#fff;display:flex;flex-direction:column;gap:8px;box-shadow:0 1px 0 rgba(0,0,0,.02)}
  .card img{width:100%;height:120px;object-fit:contain;background:#fafafa;border-radius:10px;border:1px dashed #e5e7eb}
  .name{font-weight:600}
  .price{color:#111;font-weight:700}
  .sku{color:#6b7280;font-size:.8rem}
  .btn{cursor:pointer;border:none;border-radius:10px;padding:10px 12px;background:#6c4ef7;color:#fff;font-weight:700}
  .btn:active{transform:scale(.98)}
  footer.cartbar{position:sticky;bottom:0;background:#fff;border-top:1px solid #eee;display:flex;align-items:center;gap:10px;padding:10px 12px}
  .total{margin-left:auto;font-weight:800;font-size:1.1rem}
  select, .view-cart{border:1px solid #ddd;border-radius:10px;padding:9px 10px;background:#fff}
  .items-panel{position:fixed;left:12px;right:12px;bottom:62px;background:#fff;border:1px solid #eee;border-radius:16px;max-height:40vh;overflow:auto;box-shadow:0 8px 30px rgba(0,0,0,.08);padding:10px;display:none}
  .itemrow{display:grid;grid-template-columns:1fr auto auto auto;gap:10px;align-items:center;padding:6px 0;border-bottom:1px dashed #eee}
  .qtybox{display:flex;gap:6px;align-items:center}
  .qtybox button{width:28px;height:28px;border-radius:8px;border:1px solid #ddd;background:#fff}
  .trash{border:1px solid #ddd;background:#fff;border-radius:8px;padding:6px 8px}
  .muted{color:#6b7280}
  .sticky-tip{font-size:.84rem;color:#6b7280;margin:6px 4px 0}
</style>
</head>
<body>
  <header>
    <div class="brand"><div class="dot"></div><div>DIN√ÅMITA <span style="color:var(--rojo)">POS</span></div></div>
    <div class="mode">Modo Seguro (sin impresora)</div>
  </header>

  <div class="wrap">
    <input id="q" class="search" placeholder="Buscar producto por nombre o SKU‚Ä¶"/>
    <div class="sticky-tip">Tip: toca ‚Äú+‚Äù para a√±adir, usa el panel de abajo para cambiar cantidades o eliminar.</div>
    <div id="grid" class="grid"></div>
  </div>

  <div id="panel" class="items-panel"></div>

  <footer class="cartbar">
    <button id="togglePanel" class="view-cart">Ver carrito</button>
    <select id="metodo">
      <option>Efectivo</option>
      <option>Tarjeta</option>
      <option>Transferencia</option>
    </select>
    <div class="total" id="total">$0.00</div>
    <button id="pay" class="btn">Finalizar venta</button>
  </footer>

<script>
const productos = [
  {sku:'758104001972', nombre:'Agua Bonafont 1L', precio:14},
  {sku:'758104000159', nombre:'Agua Bonafont 2L', precio:20},
  {sku:'758104005796', nombre:'Agua Bonafont 1.5L', precio:16},
  {sku:'0237433', nombre:'Gatorade 1L', precio:26},
  {sku:'037617310649', nombre:'Gatorade 600ml', precio:20},
  {sku:'7503027753', nombre:'Volt Blue', precio:22},
  {sku:'7503027753Y', nombre:'Volt Yellow', precio:22},
  {sku:'7503027753P', nombre:'Volt Pink', precio:22},
  {sku:'ELECTROLIT', nombre:'Electrolit', precio:25},
  {sku:'TPW', nombre:'T Prote√≠na Whey', precio:25},
  {sku:'TPM', nombre:'T Prote√≠na Mass', precio:35},
  {sku:'OX', nombre:'√ìxido', precio:25}
];
const grid = document.getElementById('grid');
const q = document.getElementById('q');
const panel = document.getElementById('panel');
const totalEl = document.getElementById('total');
const togglePanelBtn = document.getElementById('togglePanel');
let cart = {};

function render(products){
  grid.innerHTML = '';
  products.forEach(p=>{
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = \`
      <img alt="img" src="data:image/svg+xml;utf8,\${encodeURIComponent(genImg(p.nombre))}">
      <div class="name">\${p.nombre}</div>
      <div class="sku">\${p.sku}</div>
      <div class="price">$ \${p.precio.toFixed(2)} MXN</div>
      <button class="btn">Agregar</button>
    \`;
    card.querySelector('.btn').onclick = ()=> addToCart(p);
    grid.appendChild(card);
  });
}
function genImg(txt){
  const svg = \`
  <svg xmlns='http://www.w3.org/2000/svg' width='300' height='180'>
   <rect width='100%' height='100%' fill='#fafafa' stroke='#e5e7eb' stroke-dasharray='6,6'/>
   <text x='50%' y='54%' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='18' fill='#9ca3af'>\${txt}</text>
  </svg>\`;
  return svg;
}
function applyFilter(){
  const term = q.value.trim().toLowerCase();
  render(productos.filter(p=> (p.nombre.toLowerCase().includes(term) || p.sku.includes(term)) ));
}
q.addEventListener('input', applyFilter);

function addToCart(p){
  if(!cart[p.sku]) cart[p.sku] = {...p, cant:0};
  cart[p.sku].cant++;
  updatePanel();
}
function changeQty(sku, delta){
  if(!cart[sku]) return;
  cart[sku].cant += delta;
  if(cart[sku].cant<=0) delete cart[sku];
  updatePanel();
}
function removeItem(sku){
  delete cart[sku];
  updatePanel();
}
function calcTotal(){
  let t=0;
  Object.values(cart).forEach(i=> t += i.cant * i.precio);
  return t;
}
function updatePanel(){
  const items = Object.values(cart);
  const has = items.length>0;
  panel.style.display = has ? 'block':'none';
  togglePanelBtn.textContent = has ? 'Ocultar carrito' : 'Ver carrito';
  panel.innerHTML = items.map(i=> \`
    <div class="itemrow">
      <div><strong>\${i.cant}√ó</strong> \${i.nombre} <span class="muted">(\${i.sku})</span></div>
      <div class="muted">$ \${(i.precio*i.cant).toFixed(2)}</div>
      <div class="qtybox">
        <button onclick="changeQty('\${i.sku}',-1)">-</button>
        <button onclick="changeQty('\${i.sku}',+1)">+</button>
      </div>
      <button class="trash" onclick="removeItem('\${i.sku}')">üóë</button>
    </div>
  \`).join('');
  totalEl.textContent = '$' + calcTotal().toFixed(2);
}
togglePanelBtn.onclick = ()=>{
  const is = panel.style.display === 'block';
  panel.style.display = is ? 'none' : 'block';
  togglePanelBtn.textContent = is ? 'Ver carrito' : 'Ocultar carrito';
};

document.getElementById('pay').onclick = ()=>{
  const items = Object.values(cart);
  if(items.length===0){ alert('Agrega productos al carrito.'); return; }
  const metodo = document.getElementById('metodo').value;
  const folio = String(Math.floor(10000 + Math.random()*89999));
  const venta = {
    folio,
    fecha: new Date().toISOString(),
    status: 'Pagado',
    pagos: {[metodo.toLowerCase()]: calcTotal()},
    total: calcTotal(),
    items: items.map(i=>({ sku:i.sku, desc:i.nombre, unidad:'PIEZA', cant:i.cant, precio:i.precio }))
  };
  localStorage.setItem('dinamita_last_sale', JSON.stringify(venta));
  window.open('ticket-dinamita.html#autoprint=1', '_blank');
  cart = {}; updatePanel();
  alert('Venta registrada. Ticket abierto en una nueva pesta√±a.');
};

render(productos); updatePanel();
</script>
</body>
</html>
