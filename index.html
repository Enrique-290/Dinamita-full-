
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DIN√ÅMITA POS ‚Äî Cat√°logo con Carrito</title>
<style>
  :root{
    --bg:#ffffff;
    --text:#111;
    --muted:#6b7280;
    --primary:#e11d48; /* rojo */
    --black:#0b0b0b;
    --border:#e5e7eb;
    --chip:#f3f4f6;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background:var(--bg);
    color:var(--text);
  }
  header{
    position:sticky; top:0; z-index:20;
    background:var(--bg);
    border-bottom:1px solid var(--border);
    padding:10px 16px;
    display:flex; gap:12px; align-items:center; justify-content:space-between;
  }
  .brand{display:flex; gap:10px; align-items:center;}
  .dot{width:14px;height:14px;border-radius:50%;background:gold;box-shadow:0 0 0 2px #111 inset}
  h1{font-size:18px; margin:0;}
  .muted{color:var(--muted); font-size:12px; line-height:1.2}
  main{padding:16px; padding-bottom:120px;}
  table{width:100%; border-collapse:collapse}
  th,td{padding:14px 10px; border-bottom:1px solid var(--border); text-align:left; vertical-align:middle}
  th{font-size:13px; color:var(--muted); text-transform:uppercase; letter-spacing:.06em}
  .btn{
    background:#111; color:#fff; border:none; padding:10px 16px; border-radius:12px; font-weight:600;
  }
  .btn:active{transform:scale(.98)}
  .price{font-variant-numeric:tabular-nums}
  .sku{color:var(--muted); font-size:12px}
  /* Sticky footer bar */
  .cart-bar{
    position:fixed; left:0; right:0; bottom:0; z-index:30;
    background:var(--bg);
    border-top:1px solid var(--border);
    padding:10px 12px;
    display:flex; gap:10px; align-items:center; justify-content:space-between;
  }
  .left{display:flex; gap:10px; align-items:center;}
  .chip{background:var(--chip); border:1px solid var(--border); padding:6px 10px; border-radius:999px; font-size:13px}
  .total{font-weight:800; font-size:18px}
  .pay{padding:8px 10px; border:1px solid var(--border); border-radius:10px; background:#fff}
  /* Drawer */
  .drawer{
    position:fixed; left:10px; right:10px; bottom:62px; z-index:25;
    background:#fff; border:1px solid var(--border); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.08);
    display:none; /* hidden by default */
  }
  .drawer.open{display:block;}
  .drawer-header{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border);}
  .drawer-body{max-height:40vh; overflow:auto; padding:6px 10px;}
  .row{display:grid; grid-template-columns: 1fr auto auto auto; gap:10px; align-items:center; padding:10px; border-bottom:1px solid var(--border);}
  .row:last-child{border-bottom:none}
  .qty{display:flex; gap:8px; align-items:center;}
  .iconbtn{width:34px; height:34px; border-radius:10px; border:1px solid var(--border); background:#fff; font-weight:700}
  .trash{width:34px;height:34px; border:none; background:#fee2e2; color:#991b1b; border-radius:10px; font-weight:800}
  .hide-link{color:var(--muted); text-decoration:underline; cursor:pointer; font-size:14px}
  .footer-actions{display:flex; gap:10px; align-items:center; justify-content:space-between; padding:10px 12px;}
  .final{background:var(--primary);}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="dot"></div>
    <div>
      <div style="font-weight:800">DIN√ÅMITA <span style="color:var(--primary)">POS</span></div>
      <div class="muted">Modo Seguro (sin impresora)</div>
    </div>
  </div>
  <div>
    <input id="email" placeholder="tu correo" style="padding:10px 12px;border:1px solid var(--border);border-radius:12px;"/>
    <button class="btn" id="enterBtn">Entrar</button>
  </div>
</header>
<main>
  <h2>Cat√°logo</h2>
  <p class="muted">Tip: el carrito ahora <b>no tapa</b> los productos; si se abre puedes <b>ocultarlo</b> o deja espacio para seguir viendo la lista üëç</p>
  <table id="catalog">
    <thead>
      <tr>
        <th>SKU</th><th>Producto</th><th>$</th><th>Stock</th><th></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<!-- Drawer del carrito -->
<div class="drawer" id="drawer">
  <div class="drawer-header">
    <div style="font-weight:800">Carrito</div>
    <div class="hide-link" id="hideDrawer">Ocultar carrito</div>
  </div>
  <div class="drawer-body" id="cartList"></div>
</div>

<!-- Barra -->
<div class="cart-bar" id="cartBar">
  <div class="left">
    <span class="hide-link" id="toggleDrawer">Mostrar carrito</span>
    <span class="chip" id="itemsChip">0 items</span>
    <select id="payment" class="pay">
      <option>Efectivo</option>
      <option>Tarjeta</option>
      <option>Transferencia</option>
    </select>
  </div>
  <div style="display:flex; gap:10px; align-items:center;">
    <span class="total" id="total">$0.00</span>
    <button class="btn final" id="finish">Finalizar venta</button>
  </div>
</div>

<script>
const seed = [
  {sku:"758104000159", name:"Agua Bonafont 2L", price:20, stock:20},
  {sku:"758104005796", name:"Agua Bonafont 1.5L", price:16, stock:20},
  {sku:"0237433", name:"Gatorade 1L", price:26, stock:20},
  {sku:"036171310649", name:"Gatorade 600ml", price:20, stock:20},
  {sku:"7503027753", name:"Volt Blue", price:22, stock:20},
  {sku:"7503027753Y", name:"Volt Yellow", price:22, stock:20},
  {sku:"7503027753P", name:"Volt Pink", price:22, stock:20},
  {sku:"ELECTROLIT", name:"Electrolit", price:25, stock:20},
  {sku:"TPW", name:"T Prote√≠na Whey", price:25, stock:20},
  {sku:"TPM", name:"T Prote√≠na Mass", price:35, stock:20},
  {sku:"OX", name:"√ìxido", price:25, stock:20},
];

const tbody = document.querySelector("#catalog tbody");
const drawer = document.getElementById("drawer");
const cartList = document.getElementById("cartList");
const toggleDrawer = document.getElementById("toggleDrawer");
const hideDrawer = document.getElementById("hideDrawer");
const itemsChip = document.getElementById("itemsChip");
const totalEl = document.getElementById("total");
const finishBtn = document.getElementById("finish");

let cart = []; // {sku, name, price, qty}

function currency(n){ return "$" + n.toFixed(2); }

function renderCatalog(){
  tbody.innerHTML = "";
  seed.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><div class="sku">${p.sku}</div></td>
      <td>${p.name}</td>
      <td class="price">${currency(p.price)}</td>
      <td>${p.stock}</td>
      <td><button class="btn add" data-sku="${p.sku}">Agregar</button></td>
    `;
    tbody.appendChild(tr);
  });
}

function syncFooterPadding(){
  // Cuando el drawer est√° abierto, dejamos m√°s espacio para que no tape el listado
  document.querySelector("main").style.paddingBottom = drawer.classList.contains("open") ? "55vh" : "120px";
}

function setDrawer(open){
  drawer.classList.toggle("open", open);
  toggleDrawer.textContent = open ? "Ocultar carrito" : "Mostrar carrito";
  syncFooterPadding();
}

toggleDrawer.addEventListener("click", ()=> setDrawer(!drawer.classList.contains("open")));
hideDrawer.addEventListener("click", ()=> setDrawer(false));

function addToCart(sku){
  const prod = seed.find(p => p.sku === sku);
  if(!prod) return;
  const existing = cart.find(i => i.sku === sku);
  if(existing){ existing.qty++; }
  else { cart.push({sku:prod.sku, name:prod.name, price:prod.price, qty:1}); }
  renderCart();
  // Abre el carrito un segundo y luego se puede ocultar
  setDrawer(true);
}

function renderCart(){
  // chip & total
  const items = cart.reduce((a,b)=>a+b.qty,0);
  itemsChip.textContent = items + " items";
  const total = cart.reduce((a,b)=>a + b.qty * b.price, 0);
  totalEl.textContent = currency(total);

  // body
  cartList.innerHTML = "";
  cart.forEach((item, idx)=>{
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <div><strong>${item.name}</strong><div class="sku">${item.sku}</div></div>
      <div class="qty">
        <button class="iconbtn minus" data-idx="${idx}">‚Äì</button>
        <span>${item.qty}√ó</span>
        <button class="iconbtn plus" data-idx="${idx}">+</button>
      </div>
      <div class="price">${currency(item.qty * item.price)}</div>
      <button class="trash" data-idx="${idx}">üóë</button>
    `;
    cartList.appendChild(row);
  });
}

cartList.addEventListener("click", (e)=>{
  const idx = e.target.getAttribute("data-idx");
  if(idx === null) return;
  if(e.target.classList.contains("plus")){ cart[idx].qty++; }
  else if(e.target.classList.contains("minus")){ cart[idx].qty = Math.max(0, cart[idx].qty - 1); if(cart[idx].qty===0) cart.splice(idx,1); }
  else if(e.target.classList.contains("trash")){ cart.splice(idx,1); }
  renderCart();
});

tbody.addEventListener("click",(e)=>{
  const btn = e.target.closest(".add");
  if(!btn) return;
  addToCart(btn.dataset.sku);
});

finishBtn.addEventListener("click", ()=>{
  if(cart.length===0){ alert("Carrito vac√≠o"); return; }
  const fecha = new Date().toLocaleString();
  let html = "<h2>DIN√ÅMITA GYM ‚Äî Ticket</h2>";
  html += `<div style='color:#666'>${fecha}</div>`;
  html += "<table style='width:100%;border-collapse:collapse;margin-top:10px'>";
  html += "<tr><th style='text-align:left;border-bottom:1px solid #ddd'>Concepto</th><th style='text-align:right;border-bottom:1px solid #ddd'>$</th></tr>";
  let total = 0;
  cart.forEach(i=>{ const sub=i.qty*i.price; total+=sub; html += `<tr><td>${i.qty}√ó ${i.name}</td><td style='text-align:right'>${currency(sub)}</td></tr>`; });
  html += `<tr><td style='text-align:right;font-weight:800;border-top:1px solid #ddd'>Total</td><td style='text-align:right;font-weight:800;border-top:1px solid #ddd'>${currency(total)}</td></tr>`;
  html += "</table><p>Gracias por tu compra üí•</p>";
  const w = window.open("", "_blank");
  w.document.write(html);
  w.document.close();
  // Limpia carrito pero no cierra el drawer a la fuerza
  cart = []; renderCart();
});

// init
renderCatalog();
renderCart();
</script>
</body>
</html>
