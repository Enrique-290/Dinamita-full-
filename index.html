<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DIN√ÅMITA POS ‚Äî Cat√°logo Compacto</title>
<style>
  :root{
    --rojo:#e11d2e;
    --negro:#111;
    --gris:#f6f7f9;
    --borde:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
    background:#fff;
    color:#111827;
  }
  header{
    position:sticky; top:0; z-index:10;
    background:#fff; border-bottom:1px solid var(--borde);
    padding:12px 16px;
    display:flex; gap:12px; align-items:center; justify-content:space-between;
  }
  .marca{font-weight:800; letter-spacing:.5px}
  .marca span{color:var(--rojo)}
  .search{
    flex:1; max-width:520px; display:flex; gap:8px; align-items:center;
    border:1px solid var(--borde); border-radius:12px; padding:8px 12px; background:#fff;
  }
  .search input{
    flex:1; font-size:16px; border:0; outline:0; background:transparent;
  }
  main{padding:16px; padding-bottom:110px;}
  .grid{
    display:grid; gap:10px;
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
  /* Tablet / Desktop: m√°s columnas */
  @media (min-width: 720px){ .grid{grid-template-columns: repeat(5, minmax(0,1fr));} }
  @media (min-width: 1024px){ .grid{grid-template-columns: repeat(6, minmax(0,1fr));} }

  .card{
    border:1px solid var(--borde);
    border-radius:14px; padding:10px; background:#fff;
    display:flex; flex-direction:column; align-items:center; gap:8px;
    transition:box-shadow .15s ease, transform .05s;
  }
  .card:hover{ box-shadow:0 6px 20px rgba(0,0,0,.06); transform:translateY(-1px); }
  .thumb{
    width:100%; aspect-ratio:1/1; display:flex; align-items:center; justify-content:center;
    background:var(--gris); border-radius:10px; overflow:hidden;
  }
  .thumb img{
    height:100px; width:auto; object-fit:contain; /* imagen compacta */
  }
  .name{width:100%; font-weight:600; font-size:14px; line-height:1.2; min-height:34px;}
  .price{width:100%; font-weight:800; color:#111; font-size:14px;}
  .add{
    width:100%; border:0; cursor:pointer; border-radius:10px; padding:8px 10px;
    background:var(--rojo); color:#fff; font-weight:700; font-size:14px;
  }
  .add:active{transform:scale(.98)}
  /* Barra de carrito */
  .cartbar{
    position:fixed; left:0; right:0; bottom:0; z-index:20;
    background:#fff; border-top:1px solid var(--borde);
    padding:10px 12px; display:flex; gap:10px; align-items:center;
  }
  .cart-summary{flex:1; font-weight:700}
  .pay{background:var(--rojo); color:#fff; border:0; border-radius:12px; padding:12px 16px; font-weight:800; font-size:16px}
  .viewcart{background:#fff; border:1px solid var(--borde); border-radius:12px; padding:10px 14px; font-weight:700}
  /* Drawer carrito */
  .drawer{
    position:fixed; left:0; right:0; bottom:70px; z-index:30;
    margin: 0 10px; border:1px solid var(--borde); border-radius:14px;
    background:#fff; box-shadow:0 12px 30px rgba(0,0,0,.10); display:none;
  }
  .drawer.open{display:block;}
  .drawer header{border-bottom:1px solid var(--borde); border-radius:14px 14px 0 0}
  .drawer .content{max-height:45vh; overflow:auto; padding:12px}
  .linea{display:grid; grid-template-columns: 1fr auto auto auto; gap:10px; padding:10px 0; border-bottom:1px solid var(--borde); align-items:center}
  .qtybox{display:flex; gap:8px; align-items:center}
  .btnx{width:28px; height:28px; border:1px solid var(--borde); background:#fff; border-radius:8px; font-weight:800}
  .trash{border:1px solid var(--borde); background:#fff; border-radius:8px; padding:6px 10px}
  /* Modal ticket */
  .modal{
    position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:40;
  }
  .modal.open{display:flex;}
  .ticket{
    width:min(540px, 94vw); background:#fff; border-radius:14px; border:1px solid var(--borde);
    padding:16px;
  }
  .ticket h3{margin:0 0 8px 0}
  .ticket table{width:100%; border-collapse:collapse; font-size:14px}
  .ticket th,.ticket td{padding:8px 6px; border-bottom:1px solid var(--borde); text-align:left}
  .ticket tfoot td{font-weight:800}
  .actions{display:flex; gap:8px; justify-content:flex-end; margin-top:12px}
  .btn{border:1px solid var(--borde); background:#fff; border-radius:10px; padding:10px 12px; font-weight:700}
  .btn.primary{background:var(--rojo); color:#fff; border-color:var(--rojo)}
  .hint{color:#6b7280; font-size:12px}
</style>
</head>
<body>

<header>
  <div class="marca">DIN√ÅMITA <span>POS</span></div>
  <div class="search">
    üîé
    <input id="q" type="search" placeholder="Buscar producto o SKU‚Ä¶" />
  </div>
</header>

<main>
  <div id="grid" class="grid"></div>
</main>

<!-- Drawer carrito -->
<section id="drawer" class="drawer" aria-hidden="true">
  <header style="border:0; padding:12px 16px;">
    <strong>Carrito</strong>
  </header>
  <div class="content" id="cartLines"></div>
</section>

<!-- Barra de carrito -->
<section class="cartbar">
  <button id="toggleCart" class="viewcart">Ver carrito</button>
  <div class="cart-summary"><span id="itemsCount">0</span> √≠tems ‚Äî <strong id="total">$0.00</strong></div>
  <button id="pay" class="pay">Finalizar venta</button>
</section>

<!-- Modal Ticket -->
<section id="modal" class="modal" aria-hidden="true">
  <div class="ticket">
    <h3>DIN√ÅMITA GYM ‚Äî Ticket</h3>
    <div class="hint" id="modalHint">Modo seguro: s√≥lo compartir/cerrar.</div>
    <table id="ticketTable">
      <thead><tr><th>Concepto</th><th>Cant</th><th>$</th></tr></thead>
      <tbody></tbody>
      <tfoot><tr><td>Total</td><td></td><td id="ticketTotal">$0.00</td></tr></tfoot>
    </table>
    <div class="actions">
      <button class="btn" id="closeModal">Cerrar</button>
      <button class="btn primary" id="shareBtn">Compartir total</button>
    </div>
  </div>
</section>

<script>
const PLACEHOLDER = 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160"><rect width="100%" height="100%" fill="#f2f3f5"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9aa0a6" font-family="Arial" font-size="14">Sin imagen</text></svg>`);

const productos = [
  { sku:'758104001972', nombre:'Agua Bonafont 1L', precio:14, img:PLACEHOLDER },
  { sku:'758104000159', nombre:'Agua Bonafont 2L', precio:20, img:PLACEHOLDER },
  { sku:'758104005796', nombre:'Agua Bonafont 1.5L', precio:16, img:PLACEHOLDER },
  { sku:'0237433',        nombre:'Gatorade 1L', precio:26, img:PLACEHOLDER },
  { sku:'037617310649',   nombre:'Gatorade 600ml', precio:20, img:PLACEHOLDER },
  { sku:'7503027753',     nombre:'Volt Blue', precio:22, img:PLACEHOLDER },
  { sku:'7503027753Y',    nombre:'Volt Yellow', precio:22, img:PLACEHOLDER },
  { sku:'7503027753P',    nombre:'Volt Pink', precio:22, img:PLACEHOLDER },
  { sku:'ELECTROLIT',     nombre:'Electrolit', precio:25, img:PLACEHOLDER },
  { sku:'TPW',            nombre:'T Prote√≠na Whey', precio:25, img:PLACEHOLDER },
  { sku:'TPM',            nombre:'T Prote√≠na Mass', precio:35, img:PLACEHOLDER },
  { sku:'OX',             nombre:'√ìxido', precio:25, img:PLACEHOLDER },
];

const grid = document.getElementById('grid');
const q    = document.getElementById('q');

const drawer = document.getElementById('drawer');
const cartLines = document.getElementById('cartLines');
const toggleCartBtn = document.getElementById('toggleCart');

const itemsCount = document.getElementById('itemsCount');
const totalSpan  = document.getElementById('total');

const modal = document.getElementById('modal');
const ticketTableBody = document.querySelector('#ticketTable tbody');
const ticketTotal = document.getElementById('ticketTotal');
const closeModalBtn = document.getElementById('closeModal');
const shareBtn = document.getElementById('shareBtn');

let carrito = {}; // {sku: {sku,nombre,precio,qty}}

function money(n){ return '$' + n.toFixed(2); }

function renderGrid(list){
  grid.innerHTML = '';
  list.forEach(p => {
    const card = document.createElement('article');
    card.className = 'card';
    card.innerHTML = `
      <div class="thumb"><img src="${p.img || PLACEHOLDER}" alt="${p.nombre}" onerror="this.src='${PLACEHOLDER}'"></div>
      <div class="name">${p.nombre}</div>
      <div class="price">${money(p.precio)}</div>
      <button class="add">Agregar</button>
    `;
    card.querySelector('.add').addEventListener('click', () => addToCart(p));
    grid.appendChild(card);
  });
}

function addToCart(p){
  const line = carrito[p.sku] || { ...p, qty:0 };
  line.qty += 1;
  carrito[p.sku] = line;
  refreshCartUI();
}

function refreshCartUI(){
  const items = Object.values(carrito);
  const count = items.reduce((a,b)=>a+b.qty,0);
  const total = items.reduce((a,b)=>a + b.qty*b.precio,0);
  itemsCount.textContent = count;
  totalSpan.textContent = money(total);

  cartLines.innerHTML = items.length ? '' : '<div style="padding:12px;color:#6b7280">Carrito vac√≠o</div>';
  items.forEach(line=>{
    const row = document.createElement('div');
    row.className = 'linea';
    row.innerHTML = `
      <div><strong>${line.nombre}</strong><div class="hint">${line.sku}</div></div>
      <div class="qtybox">
        <button class="btnx menos">‚Äì</button>
        <div>${line.qty}x</div>
        <button class="btnx mas">+</button>
      </div>
      <div><strong>${money(line.qty*line.precio)}</strong></div>
      <button class="trash">üóë</button>
    `;
    row.querySelector('.menos').onclick = () => { line.qty=Math.max(0,line.qty-1); if(!line.qty) delete carrito[line.sku]; refreshCartUI(); };
    row.querySelector('.mas').onclick   = () => { line.qty+=1; refreshCartUI(); };
    row.querySelector('.trash').onclick = () => { delete carrito[line.sku]; refreshCartUI(); };
    cartLines.appendChild(row);
  });
}

q.addEventListener('input', ()=>{
  const term = q.value.trim().toLowerCase();
  const filtered = term
    ? productos.filter(p => (p.nombre + ' ' + p.sku).toLowerCase().includes(term))
    : productos;
  renderGrid(filtered);
});

toggleCartBtn.addEventListener('click', ()=>{
  drawer.classList.toggle('open');
});

document.getElementById('pay').addEventListener('click', ()=>{
  const items = Object.values(carrito);
  if(!items.length){ alert('Agrega productos al carrito.'); return; }
  ticketTableBody.innerHTML = '';
  let total = 0;
  items.forEach(l=>{
    total += l.qty*l.precio;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${l.nombre}</td><td>${l.qty}</td><td>${money(l.qty*l.precio)}</td>`;
    ticketTableBody.appendChild(tr);
  });
  ticketTotal.textContent = money(total);
  modal.classList.add('open');
});

closeModalBtn.onclick = ()=> { modal.classList.remove('open'); };

shareBtn.onclick = async ()=>{
  const items = Object.values(carrito);
  const lines = items.map(l=> `${l.qty}x ${l.nombre} ‚Äì ${money(l.qty*l.precio)}`).join('\\n');
  const total = items.reduce((a,b)=>a + b.qty*b.precio,0);
  const text = `DIN√ÅMITA GYM ‚Äî Ticket\\n${lines}\\nTotal: ${money(total)}\\nGracias por tu compra üí•`;
  try{
    if(navigator.share){ await navigator.share({ text }); }
    else{
      await navigator.clipboard.writeText(text);
      alert('Ticket copiado al portapapeles.');
    }
  }catch(e){}
};

renderGrid(productos);
refreshCartUI();
</script>
</body>
</html>
